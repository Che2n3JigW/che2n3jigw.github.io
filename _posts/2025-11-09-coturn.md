---
categories: Android
tags: webrtc
title: Coturn（TURN/STUN）服务器部署
toc: true
toc_sticky: true
excerpt: Coturn 是常用的开源 TURN/STUN 服务器，通过配置监听端口、认证用户和启动服务，可为 WebRTC 提供 NAT 穿透和中继支持。
---

Coturn 是最常用的开源 TURN/STUN 服务器。

# 安装

```bash
sudo apt update
sudo apt install coturn -y
```

# 配置 Coturn

编辑配置文件：

```
sudo nano /etc/turnserver.conf
```

最基本配置：

```bash
# 客户端通过 3478 端口连接 TURN 服务器进行中继通信（NAT 穿透）。
listening-port=3478

# 服务器会接收任意到达本机的客户端请求，而不仅限于某个网卡。
listening-ip=0.0.0.0

# 如果 TURN 服务器有多网卡或者在 NAT 后面，可以指定特定 IP 做中继；否则 0.0.0.0 表示自动使用合适的 IP。
relay-ip=0.0.0.0

# 开启 Long-Term Credential Mechanism（长期认证机制）。
lt-cred-mech

# 定义一个静态用户，用于 长期认证机制。
user=turnuser:turnpassword

# 定义 TURN 认证领域（realm）。
realm=che2n3jigw.local

# 启用日志
verbose
```

# 启动 Coturn

临时启动（命令行方式）：

```bash
sudo turnserver -c /etc/turnserver.conf
```

验证是否在监听 3478 端口：

```bash
sudo netstat -tulnp | grep 3478
```

# 校验

[trickle-ice](https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/)

``` makefile
turn:YOUR_SERVER_IP:3478
用户名: turnuser
密码: turnpassword
```

{% 
include figure popup=true image_path="/assets/images/android/webrtc/check_turn_stun.png" 
%}
